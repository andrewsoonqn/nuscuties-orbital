name: Godot Tests via GDUnit

on:
  push:
    paths:
      - 'nuscuties-orbital/frontend/**'
      - '.github/workflows/godot-tests.yml'
  pull_request:
    paths:
      - 'nuscuties-orbital/frontend/**'

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x' # or your required version

      - name: Download Godot (Mono)
        run: |
          wget https://github.com/godotengine/godot/releases/download/4.2.2-stable/Godot_v4.2.2-stable_mono_linux_x86_64.zip
          unzip Godot_v4.2.2-stable_mono_linux_x86_64.zip
          chmod +x Godot_v4.2.2-stable_mono_linux_x86_64/Godot_v4.2.2-stable_mono_linux.x86_64

      - name: Restore C# dependencies
        run: dotnet restore './frontend/nuscuties app.sln'


      - name: Build C# project
        run: dotnet build './frontend/nuscuties app.sln'

      - name: Run GdUnit4 tests
        run: |
          ./Godot_v4.2.2-stable_mono_linux_x86_64/Godot_v4.2.2-stable_mono_linux.x86_64 --headless --path ./frontend --test
